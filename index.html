<!DOCTYPE html>
<html lang="ja">
<head>

     <link rel="apple-touch-icon" href="data:image/jpeg;base64,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" />

    
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="OnlineChat" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <meta name="theme-color" content="#000000" />
    <link rel="manifest" href="/manifest.json">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>OnlineChat</title>
    <style>
        /* [既存のスタイル] */
        * {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            background-color: #7b8f94; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            color: #000;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        #chat-header {
            background-color: #3d414d;
            color: white;
            padding: 10px;
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            font-size: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            z-index: 10;
        }
        #chat-header h1 {
            margin: 0;
            font-size: 1em;
            font-weight: bold;
            flex-grow: 1; 
            text-align: center;
        }
        #settings-tab {
            background: none;
            border: none;
            color: white;
            font-size: 14px;
            padding: 0 10px;
            cursor: pointer;
        }

        #messages {
            flex: 1;
            padding: 20px 10px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px; 
        }

        .message-container {
            display: flex;
            flex-direction: column;
            max-width: 70%;
        }
        .sender-name {
            font-size: 12px;
            color: #333;
            margin-left: 5px;
            margin-bottom: 4px;
        }
        .message-bubble {
            padding: 10px 14px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
            word-wrap: break-word; 
            white-space: pre-wrap; 
        }

        .other-message {
            align-self: flex-start;
            align-items: flex-start;
        }
        .other-message .message-bubble {
            background-color: #ffffff;
            border-top-left-radius: 4px;
        }

        .my-message {
            align-self: flex-end;
            align-items: flex-end;
        }
        .my-message .sender-name {
            display: none; 
        }
        .my-message .message-bubble {
            background-color: #8de041; 
            border-top-right-radius: 4px;
        }

        .system-message {
            align-self: center;
            background-color: rgba(0, 0, 0, 0.2);
            color: white;
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 10px;
            text-align: center;
        }

        #chat-controls {
            display: flex;
            padding: 8px;
            background-color: #f0f0f0;
            border-top: 1px solid #ddd;
            align-items: center;
        }
        #input {
            flex: 1;
            padding: 10px;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 20px;
            background-color: #fff;
            color: #000;
        }
        #input:focus {
            outline: none;
            border-color: #007bff;
        }

        #send {
            margin-left: 8px;
            padding: 10px 16px;
            background-color: #007bff;
            border: none;
            border-radius: 20px;
            color: #fff;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #send:hover {
            background-color: #0056b3;
        }

        #userlist {
            display: none;
        }

        /* =====================================
           🔔 設定画面 (オーバーレイ) のスタイル
           ===================================== */
        #settings-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); 
            z-index: 1000; 
            display: none; 
            align-items: center;
            justify-content: center;
        }
        .settings-content {
            background-color: #f9f9f9;
            width: 90%;
            max-width: 400px;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            position: relative;
        }
        .settings-content h2 {
            margin-top: 0;
            font-size: 20px;
            color: #3d414d;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        #close-settings {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            color: #666;
            cursor: pointer;
        }
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px dotted #ccc;
            font-size: 14px;
        }
        .status-granted { color: #28a745; font-weight: bold; }
        .status-denied { color: #dc3545; font-weight: bold; }
        .status-default { color: #ffc107; font-weight: bold; }
        .settings-button-group button {
            width: 100%;
            padding: 12px;
            margin-top: 15px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #request-permission-button {
            background-color: #007bff;
            color: white;
        }
        #test-notification-button {
            background-color: #28a745;
            color: white;
        }
        .status-message {
            margin-top: 15px;
            font-size: 12px;
            color: #555;
            padding: 5px;
            background-color: #eee;
            border-radius: 4px;
            display: block; /* 常に表示 */
        }
        
        /* トグルスイッチのスタイル */
        .switch {
          position: relative;
          display: inline-block;
          width: 40px;
          height: 24px;
        }
        .switch input { 
          opacity: 0;
          width: 0;
          height: 0;
        }
        .slider {
          position: absolute;
          cursor: pointer;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-color: #ccc;
          -webkit-transition: .4s;
          transition: .4s;
        }
        .slider:before {
          position: absolute;
          content: "";
          height: 18px;
          width: 18px;
          left: 3px;
          bottom: 3px;
          background-color: white;
          -webkit-transition: .4s;
          transition: .4s;
        }
        input:checked + .slider {
          background-color: #2196F3;
        }
        input:focus + .slider {
          box-shadow: 0 0 1px #2196F3;
        }
        input:checked + .slider:before {
          -webkit-transform: translateX(16px);
          -ms-transform: translateX(16px);
          transform: translateX(16px);
        }
        .slider.round {
          border-radius: 34px;
        }
        .slider.round:before {
          border-radius: 50%;
        }
    </style>
</head>
<body>
    <header id="chat-header">
        <div></div> 
        <h1>OnlineChat</h1>
        <button id="settings-tab">設定</button>
    </header>
    <div id="messages"></div>
    <div id="chat-controls">
        <input id="input" placeholder="メッセージを入力" list="sug">
        <button id="send">送信</button>
    </div>
    <datalist id="sug"></datalist>
    <div id="userlist"></div>

    <div id="settings-overlay">
        <div class="settings-content">
            <button id="close-settings">&times;</button>
            <h2>通知設定とテスト</h2>

            <div id="notification-status">
                <div class="status-item">Service Worker: <span id="swStatus">未登録</span></div>
                <div class="status-item">OS通知権限: <span id="permissionStatus">不明</span></div>
                
                <div class="status-item">
                    <span>チャット通知 (アプリ内オフ):</span>
                    <label class="switch">
                        <input type="checkbox" id="notificationToggle">
                        <span class="slider round"></span>
                    </label>
                </div>

                <div class="status-item status-message">
                    💡 **重要**: Service Workerパス: <span id="basePath">...</span>
                </div>
            </div>

            <div class="settings-button-group">
                <button id="request-permission-button">OS通知の権限をリクエスト</button>
                <button id="test-notification-button" disabled>テスト通知を表示 (5秒後)</button>
            </div>
        </div>
    </div>

<script>
    let isAdmin = false;
    let username = '';
    const socket = new WebSocket("wss://superchat.maikanamaikana.workers.dev/ws");
    let lastMessage = "";

    let swRegistration = null;
    const NOTIF_STORAGE_KEY = 'chat_notification_enabled'; // 通知ON/OFFの状態を保存するキー

    // DOM要素の取得
    const swStatus = document.getElementById('swStatus');
    const permissionStatus = document.getElementById('permissionStatus');
    const basePathElement = document.getElementById('basePath');
    const requestPermissionButton = document.getElementById('request-permission-button');
    const testNotificationButton = document.getElementById('test-notification-button');
    const settingsOverlay = document.getElementById('settings-overlay');
    const settingsTab = document.getElementById('settings-tab');
    const closeSettingsButton = document.getElementById('close-settings');
    const notificationToggle = document.getElementById('notificationToggle'); // トグルボタンを取得

    // ===============================================
    // 🔔 Service Worker パス/スコープの自動計算 (GitHub Pages対応) 🔔
    // ===============================================
    const pathSegments = window.location.pathname.split('/').filter(Boolean);
    const repoName = pathSegments.length > 0 ? `/${pathSegments[0]}` : '';
    const swPath = `${repoName}/sw.js`;
    const swScope = `${repoName}/`; 
    
    basePathElement.textContent = swPath;

    /**
     * ローカルストレージから通知設定の状態を取得する
     * @returns {boolean} true: 通知オフ, false: 通知オン
     */
    function isNotificationOff() {
        // localStorageが'false'という文字列の場合は通知オフ
        return localStorage.getItem(NOTIF_STORAGE_KEY) === 'false';
    }
    
    /**
     * ステータス表示を更新する
     */
    function updateStatus() {
        const permission = Notification.permission;
        permissionStatus.textContent = permission;
        permissionStatus.className = '';
        
        // テストボタンの有効化/無効化
        const isReady = permission === 'granted' && swRegistration !== null;
        testNotificationButton.disabled = !isReady;

        // 権限リクエストボタンの状態
        if (permission === 'granted') {
            permissionStatus.classList.add('status-granted');
            requestPermissionButton.disabled = true;
            requestPermissionButton.textContent = "OS通知は許可済みです";
        } else if (permission === 'denied') {
            permissionStatus.classList.add('status-denied');
            requestPermissionButton.disabled = true;
            requestPermissionButton.textContent = "OS設定でブロックされています";
        } else {
            permissionStatus.classList.add('status-default');
            requestPermissionButton.disabled = false;
            requestPermissionButton.textContent = "OS通知の権限をリクエスト";
        }
        
        swStatus.textContent = swRegistration ? '登録済み' : '未登録';
        swStatus.classList.add(swRegistration ? 'status-granted' : 'status-denied');

        // トグルボタンの状態を更新
        if (notificationToggle) {
            // isNotificationOff()がfalse（通知オン）ならチェックを入れる
            notificationToggle.checked = !isNotificationOff();
        }
    }

    // 1. Service Workerの登録
    function registerServiceWorker() {
        if (!("serviceWorker" in navigator)) {
            swStatus.textContent = "未サポート";
            return;
        }
        
        navigator.serviceWorker.register(swPath, { scope: swScope })
            .then((reg) => {
                console.log("Service worker registered successfully. Path:", swPath, "Scope:", swScope);
                swRegistration = reg;
                updateStatus(); 
            })
            .catch((error) => {
                console.error("Service worker registration failed. CHECK PATH/SCOPE:", error);
                swStatus.textContent = `失敗: ${error.message}`;
                updateStatus(); 
            });
    }

    // ===============================================
    // 💡 設定画面のイベントリスナー
    // ===============================================
    
    /**
     * 通知権限をリクエストする
     */
    requestPermissionButton.addEventListener('click', () => {
        Notification.requestPermission()
            .then((permission) => {
                console.log("Notification permission:", permission);
                updateStatus();
                if (permission === 'denied') {
                    alert('通知が拒否されました。iPadの設定アプリから手動で許可してください。');
                }
            })
            .catch((error) => console.error("Permission request failed:", error));
    });

    /**
     * テスト通知を表示する (5秒遅延)
     */
    function showDelayedNotification() {
        if (Notification.permission === 'granted' && swRegistration) {
            
            const bodyMessage = 'ボタンを押してから5秒後に届きました！（アプリ内オフ設定を無視して送信）';
            
            swRegistration.showNotification('⏱️ テスト通知', {
                body: bodyMessage,
                icon: `${repoName}/apple-touch-icon.png`, 
                tag: 'test-notification',
                renotify: true,
                badge: `${repoName}/apple-touch-icon.png`
            })
            .catch(error => {
                console.error('Failed to show delayed notification:', error);
            });
        }
    }

    testNotificationButton.addEventListener('click', () => {
        if (testNotificationButton.disabled) {
            alert('Service Workerが未登録か、OS通知権限がありません。');
            return;
        }
        
        setTimeout(showDelayedNotification, 5000);

        alert('✅ 5秒後に通知が表示されます。アプリを開いたままでも届きます。');
    });
    
    /**
     * 通知トグルボタンの処理
     */
    notificationToggle.addEventListener('change', () => {
        const isChecked = notificationToggle.checked;
        // チェックが入っている(true)なら通知ON、チェックなし(false)なら通知OFFとしてlocalStorageに保存
        localStorage.setItem(NOTIF_STORAGE_KEY, isChecked ? 'true' : 'false');
        
        if (!isChecked) {
            alert("アプリ内通知がオフになりました。新しいメッセージがあってもOS通知はされません。");
        } else {
             alert("アプリ内通知がオンになりました。");
        }
        updateStatus();
    });


    // 設定画面の開閉ロジック
    settingsTab.addEventListener('click', () => {
        settingsOverlay.style.display = 'flex';
        updateStatus(); // 開くたびに最新のステータスに更新
    });

    closeSettingsButton.addEventListener('click', () => {
        settingsOverlay.style.display = 'none';
    });

    // ===============================================
    // 💬 チャット機能（メッセージ処理）
    // ===============================================
    
    function appendMessage(name, text, options = {}) {
        // [省略：メッセージ表示ロジックは変更なし]
        const { isMine = false, type = 'user' } = options;
        const messagesDiv = document.getElementById("messages");

        if (type === 'system') {
            const p = document.createElement("div");
            p.className = 'system-message';
            p.textContent = text;
            messagesDiv.appendChild(p);
        } else {
            const container = document.createElement("div");
            container.className = 'message-container ' + (isMine ? 'my-message' : 'other-message');

            if (!isMine) {
                const nameSpan = document.createElement("span");
                nameSpan.className = 'sender-name';
                nameSpan.textContent = name;
                container.appendChild(nameSpan);
            }

            const bubble = document.createElement("div");
            bubble.className = 'message-bubble';
            bubble.textContent = text;
            
            container.appendChild(bubble);
            messagesDiv.appendChild(container);
        }
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    function send() {
        const input = document.getElementById("input");
        const msg = input.value.trim();
        if (!msg) return;
        if (msg === lastMessage) return;
        lastMessage = msg;

        // [省略：コマンド処理ロジックは変更なし]
        if (msg.startsWith('@kick ') && isAdmin) {
            const target = msg.match(/@kick\s+"(.+?)"/)?.[1];
            if (target) {
                if (confirm(`本当に ${target} をキックしますか？`)) {
                    socket.send(JSON.stringify({ type: "system", action: "kick", target }));
                    appendMessage(null, `${target} をキックしました`, { type: 'system' });
                } else {
                    appendMessage(null, `${target} のキックをキャンセルしました`, { type: 'system' });
                }
            } else {
                alert("キックするユーザー名を指定してください\n例: @kick \"ユーザー名\"");
            }
        } else if (msg.startsWith('@tell ') && isAdmin) {
            const match = msg.match(/@tell\s+"(.+?)"\s+(.+)/);
            if (match) {
                const to = match[1];
                const privateMsg = match[2];
                socket.send(JSON.stringify({ type: "private", from: username, to, msg: privateMsg }));
                appendMessage(username, `[${to} へのDM] ${privateMsg}`, { isMine: true });
            } else {
                alert("プライベートメッセージの形式が正しくありません\n例: @tell \"ユーザー名\" メッセージ");
            }
        } else {
            socket.send(JSON.stringify({ type: "msg", name: username, msg }));
            appendMessage(username, msg, { isMine: true });
        }
        input.value = "";
    }

    function promptName() {
        let name = prompt("名前を入力（アルファベットのみ）");
        while (!name || !/^[A-Za-z]+$/.test(name)) {
            name = prompt("名前はアルファベットのみで入力してください");
        }
        return name;
    }

    username = promptName();

    socket.addEventListener("open", () => {
        appendMessage(null, "接続されました", { type: 'system' });
    });

    socket.addEventListener("message", (event) => {
        const data = JSON.parse(event.data);

        if (data.name === username) return;

        if (data.type === "system") {
            // ... システムメッセージ処理 ...
            if (data.msg === "キックされました") {
                alert("キックされました");
                document.body.innerHTML = "<h1 style='color:white;text-align:center;'>キックされました</h1>";
                return;
            }
            appendMessage(null, `[System] ${data.msg}`, { type: 'system' });

        } else if (data.type === "private" && data.to === username) {
            // ... DMメッセージ処理 ...
            appendMessage(null, `[${data.from}からのDM] ${data.msg}`, { type: 'system' });
            
            // DM受信時の通知表示
            if (Notification.permission === "granted" && swRegistration && !isNotificationOff()) {
                swRegistration.showNotification(`${data.from}からプライベートメッセージ`, {
                    body: data.msg,
                    icon: `${repoName}/apple-touch-icon.png`, 
                    tag: 'private-message', 
                });
            }
            
        } else if (data.name && data.msg) {
            appendMessage(data.name, data.msg, { isMine: false });
            
            // 💡 一般メッセージ受信時の通知表示 (document.hiddenチェックを削除し、トグル設定をチェック)
            if (Notification.permission === "granted" && swRegistration && !isNotificationOff()) {
                swRegistration.showNotification(`新着メッセージ: ${data.name}`, {
                    body: data.msg, 
                    icon: `${repoName}/apple-touch-icon.png`,
                    tag: 'new-chat-message',
                });
            }
        }
    });

    document.getElementById("send").onclick = send;
    document.getElementById("input").addEventListener("keydown", (e) => {
        if (e.key === "Enter" && !e.isComposing) {
            e.preventDefault(); 
            send();
        }
        if (e.key === "@") {
            if (!isAdmin) {
                const pass = prompt("管理者パスワードを入力してください");
                if (pass === "maito#2025_SecureKey!") {
                    isAdmin = true;
                    alert("管理者モードになりました");
                } else {
                    alert("パスワードが違います");
                }
            } else {
                document.getElementById("sug").innerHTML = `
                    <option value='@kick "username"'></option>
                    <option value='@tell "username" メッセージ'></option>
                `;
            }
        }
    });
    
    // アプリ起動時にService Worker登録を試みる
    window.onload = registerServiceWorker; 
</script>
</body>
</html>
